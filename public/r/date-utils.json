{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "date-utils",
  "type": "registry:lib",
  "title": "Date Utilities",
  "description": "Date conversion and parsing utilities for Dutch date format support",
  "dependencies": ["@internationalized/date", "date-fns"],
  "files": [
    {
      "path": "lib/date-utils.ts",
      "type": "registry:lib",
      "content": "import {\n  CalendarDate,\n  fromDate,\n  getLocalTimeZone,\n  toCalendarDate,\n  type ZonedDateTime,\n} from \"@internationalized/date\";\nimport { isValid } from \"date-fns\";\n\nconst DEFAULT_TIMEZONE = \"Europe/Amsterdam\";\n\n/**\n * Convert a JavaScript Date object to a CalendarDate object\n *\n * @param jsDate - The JavaScript Date object to convert\n * @returns A CalendarDate object representing the same date\n */\nexport function jsDateToCalendarDate(jsDate: Date): CalendarDate {\n  return toCalendarDate(fromDate(jsDate, getLocalTimeZone()));\n}\n\n/**\n * Convert a CalendarDate object to a JavaScript Date object\n *\n * @param calendarDate - The CalendarDate object to convert\n * @param timeZone - The time zone to use for conversion (defaults to Europe/Amsterdam)\n * @returns A JavaScript Date object representing the same date\n */\nexport function calendarDateToJsDate(\n  calendarDate: CalendarDate,\n  timeZone: string = DEFAULT_TIMEZONE\n): Date {\n  return calendarDate.toDate(timeZone);\n}\n\n/**\n * Convert a JavaScript Date to a ZonedDateTime\n *\n * @param jsDate - The JavaScript Date object to convert\n * @param timeZone - The time zone to use (defaults to Europe/Amsterdam)\n * @returns A ZonedDateTime object\n */\nexport function jsDateToZonedDateTime(\n  jsDate: Date,\n  timeZone: string = DEFAULT_TIMEZONE\n): ZonedDateTime {\n  return fromDate(jsDate, timeZone);\n}\n\n/**\n * Convert a ZonedDateTime to a JavaScript Date\n *\n * @param zonedDateTime - The ZonedDateTime object to convert\n * @returns A JavaScript Date object\n */\nexport function zonedDateTimeToJsDate(zonedDateTime: ZonedDateTime): Date {\n  return zonedDateTime.toDate();\n}\n\n/**\n * Convert a date string (YYYY-MM-DD) to a CalendarDate\n *\n * @param dateString - The date string in YYYY-MM-DD format\n * @returns A CalendarDate object\n */\nexport function dateStringToCalendarDate(dateString: string): CalendarDate {\n  const [year, month, day] = dateString.split(\"-\").map(Number);\n  if (!(year && month && day)) {\n    throw new Error(\n      `Invalid date string format: ${dateString}. Expected format: YYYY-MM-DD`\n    );\n  }\n  return new CalendarDate(year, month, day);\n}\n\n/**\n * Convert a CalendarDate to a date string (YYYY-MM-DD)\n *\n * @param calendarDate - The CalendarDate object to convert\n * @returns A date string in YYYY-MM-DD format\n */\nexport function calendarDateToDateString(calendarDate: CalendarDate): string {\n  return calendarDate.toString();\n}\n\n/**\n * Safely convert any date-like value to a CalendarDate\n *\n * @param value - A Date object, number (timestamp), or date string\n * @returns A CalendarDate object or null if conversion fails\n */\nexport function toCalendarDateSafe(\n  value: Date | number | string | undefined | null\n): CalendarDate | null {\n  if (!value) return null;\n\n  try {\n    if (value instanceof Date) {\n      return jsDateToCalendarDate(value);\n    }\n\n    if (typeof value === \"number\") {\n      return jsDateToCalendarDate(new Date(value));\n    }\n\n    if (typeof value === \"string\") {\n      // Handle YYYY-MM-DD format\n      if (/^\\d{4}-\\d{2}-\\d{2}$/.test(value)) {\n        return dateStringToCalendarDate(value);\n      }\n      // Handle other date string formats\n      return jsDateToCalendarDate(new Date(value));\n    }\n\n    return null;\n  } catch (error) {\n    console.warn(\"Failed to convert value to CalendarDate:\", value, error);\n    return null;\n  }\n}\n\n/**\n * Safely convert a CalendarDate to a JavaScript Date\n *\n * @param calendarDate - The CalendarDate to convert\n * @param timeZone - The time zone to use for conversion\n * @returns A JavaScript Date object or null if conversion fails\n */\nexport function toJsDateSafe(\n  calendarDate: CalendarDate | null | undefined,\n  timeZone: string = DEFAULT_TIMEZONE\n): Date | null {\n  if (!calendarDate) return null;\n\n  try {\n    return calendarDateToJsDate(calendarDate, timeZone);\n  } catch (error) {\n    console.warn(\n      \"Failed to convert CalendarDate to Date:\",\n      calendarDate,\n      error\n    );\n    return null;\n  }\n}\n\n/**\n * Parse a Dutch-formatted date input string into a Date object.\n * Supports multiple input formats:\n * - With separators: \"02-02-2025\", \"02/02/2025\", \"2-2-2025\", \"2/2/25\"\n * - Without separators: \"02022025\" (8 digits), \"2022025\" (7 digits), \"222025\" (6 digits)\n *\n * For 2-digit years: 00-29 → 2000-2029, 30-99 → 1930-1999\n *\n * @param input - The user input string to parse\n * @returns A valid Date object or null if parsing fails\n */\nexport function parseDutchDateInput(input: string): Date | null {\n  if (!input || input.trim() === \"\") return null;\n\n  const trimmed = input.trim();\n\n  // Check if input contains separators (- or /)\n  if (trimmed.includes(\"-\") || trimmed.includes(\"/\")) {\n    return parseDateWithSeparators(trimmed);\n  }\n\n  // No separators - parse as digits only\n  return parseDateWithoutSeparators(trimmed);\n}\n\n/**\n * Parse date string with separators (dd-MM-yyyy, dd/MM/yyyy, d-M-yy, etc.)\n */\nfunction parseDateWithSeparators(input: string): Date | null {\n  // Split by - or /\n  const parts = input.split(/[-/]/);\n  if (parts.length !== 3) return null;\n\n  const dayStr = parts[0];\n  const monthStr = parts[1];\n  const yearStr = parts[2];\n\n  if (!(dayStr && monthStr && yearStr)) return null;\n\n  const day = Number.parseInt(dayStr, 10);\n  const month = Number.parseInt(monthStr, 10);\n  let year = Number.parseInt(yearStr, 10);\n\n  if (Number.isNaN(day) || Number.isNaN(month) || Number.isNaN(year)) {\n    return null;\n  }\n\n  // Handle 2-digit years\n  if (year < 100) {\n    year = year <= 29 ? 2000 + year : 1900 + year;\n  }\n\n  return createValidDate(day, month, year);\n}\n\n/**\n * Parse date string without separators (ddMMyyyy, dMMyyyy, ddMyyyy, dMyyyy)\n * Format assumption: DD MM YYYY (Dutch format)\n */\nfunction parseDateWithoutSeparators(input: string): Date | null {\n  // Remove any non-digit characters\n  const digits = input.replace(/\\D/g, \"\");\n\n  // Need at least 6 digits (d+m+yyyy) and at most 8 (dd+mm+yyyy)\n  if (digits.length < 6 || digits.length > 8) return null;\n\n  // Extract year (always last 4 digits for full year, or last 2 for short year)\n  let year: number;\n  let remaining: string;\n\n  if (digits.length >= 6) {\n    // Check if we have a 4-digit year or 2-digit year\n    // Strategy: try 4-digit year first (more common for explicit input)\n    if (digits.length >= 6 && digits.length <= 8) {\n      // Assume last 4 digits are year if we have 6-8 digits\n      const yearStr = digits.slice(-4);\n      year = Number.parseInt(yearStr, 10);\n      remaining = digits.slice(0, -4);\n\n      // If year seems invalid (like 0202 when user typed 2022025),\n      // try treating last 2 as year\n      if (year < 1900 || year > 2100) {\n        const shortYearStr = digits.slice(-2);\n        const shortYear = Number.parseInt(shortYearStr, 10);\n        year = shortYear <= 29 ? 2000 + shortYear : 1900 + shortYear;\n        remaining = digits.slice(0, -2);\n      }\n    } else {\n      return null;\n    }\n  } else {\n    return null;\n  }\n\n  // Now parse day and month from remaining digits (2-4 digits)\n  // remaining could be: \"dd\" + \"mm\" (4 digits), \"d\" + \"mm\" (3 digits),\n  // \"dd\" + \"m\" (3 digits), or \"d\" + \"m\" (2 digits)\n  const dayMonth = parseRemainingDayMonth(remaining);\n  if (!dayMonth) return null;\n\n  return createValidDate(dayMonth.day, dayMonth.month, year);\n}\n\n/**\n * Parse the remaining day+month digits after year extraction\n * Tries different combinations to find a valid date\n */\nfunction parseRemainingDayMonth(\n  remaining: string\n): { day: number; month: number } | null {\n  const len = remaining.length;\n\n  if (len < 2 || len > 4) return null;\n\n  // Generate possible interpretations\n  const possibilities: Array<{ day: number; month: number }> = [];\n\n  if (len === 4) {\n    // DD MM format\n    possibilities.push({\n      day: Number.parseInt(remaining.slice(0, 2), 10),\n      month: Number.parseInt(remaining.slice(2, 4), 10),\n    });\n  } else if (len === 3) {\n    // Could be D MM or DD M\n    possibilities.push({\n      day: Number.parseInt(remaining.slice(0, 1), 10),\n      month: Number.parseInt(remaining.slice(1, 3), 10),\n    });\n    possibilities.push({\n      day: Number.parseInt(remaining.slice(0, 2), 10),\n      month: Number.parseInt(remaining.slice(2, 3), 10),\n    });\n  } else if (len === 2) {\n    // D M format\n    possibilities.push({\n      day: Number.parseInt(remaining.slice(0, 1), 10),\n      month: Number.parseInt(remaining.slice(1, 2), 10),\n    });\n  }\n\n  // Return first valid combination\n  for (const p of possibilities) {\n    if (isValidDayMonth(p.day, p.month)) {\n      return p;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Check if day and month values are within valid ranges\n */\nfunction isValidDayMonth(day: number, month: number): boolean {\n  return day >= 1 && day <= 31 && month >= 1 && month <= 12;\n}\n\n/**\n * Create a Date object and validate it's a real date\n * (e.g., rejects 31-02-2025)\n */\nfunction createValidDate(\n  day: number,\n  month: number,\n  year: number\n): Date | null {\n  // Basic range check\n  if (\n    day < 1 ||\n    day > 31 ||\n    month < 1 ||\n    month > 12 ||\n    year < 1900 ||\n    year > 2100\n  ) {\n    return null;\n  }\n\n  // Create date (month is 0-indexed in JS Date)\n  const date = new Date(year, month - 1, day);\n\n  // Validate the date is real by checking if the values match\n  // (Date auto-corrects invalid dates, e.g., Feb 31 becomes Mar 3)\n  if (\n    date.getFullYear() !== year ||\n    date.getMonth() !== month - 1 ||\n    date.getDate() !== day\n  ) {\n    return null;\n  }\n\n  // Double-check with date-fns isValid\n  if (!isValid(date)) {\n    return null;\n  }\n\n  return date;\n}\n\n/**\n * Format a Date object to Dutch date string (dd-MM-yyyy)\n *\n * @param date - The Date object to format\n * @returns Formatted string in dd-MM-yyyy format\n */\nexport function formatDutchDate(date: Date): string {\n  const day = date.getDate().toString().padStart(2, \"0\");\n  const month = (date.getMonth() + 1).toString().padStart(2, \"0\");\n  const year = date.getFullYear();\n  return `${day}-${month}-${year}`;\n}\n"
    }
  ]
}
