{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "gatehouse-demo",
  "type": "registry:block",
  "title": "Gatehouse Demo",
  "description": "Interactive demo showing RBAC, ABAC, and ReBAC authorization policies with evaluation tracing",
  "dependencies": [
    "@/registry/new-york/lib/gatehouse",
    "@/registry/new-york/ui/card",
    "@/registry/new-york/ui/button"
  ],
  "files": [
    {
      "path": "routes/gatehouse-demo.tsx",
      "type": "registry:page",
      "content": "/**\n * Gatehouse Authorization Demo\n * \n * Interactive demonstration of RBAC, ABAC, and ReBAC authorization patterns\n * using the Gatehouse-TS library.\n */\n\nimport { createSignal, For, Show } from \"solid-js\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/registry/new-york/ui/card\";\nimport { Button } from \"@/registry/new-york/ui/button\";\nimport {\n  type User,\n  type Document,\n  type Action,\n  type PolicyMode,\n  sampleUsers,\n  sampleDocuments,\n  createPermissionChecker,\n  getPolicyDescription,\n} from \"./lib/demo-policies\";\n\nexport function GatehouseDemo() {\n  // State\n  const [selectedUser, setSelectedUser] = createSignal<User>(sampleUsers[0]);\n  const [selectedDoc, setSelectedDoc] = createSignal<Document>(sampleDocuments[0]);\n  const [selectedAction, setSelectedAction] = createSignal<Action>(\"read\");\n  const [policyMode, setPolicyMode] = createSignal<PolicyMode>(\"combined\");\n  const [result, setResult] = createSignal<\"granted\" | \"denied\" | null>(null);\n  const [trace, setTrace] = createSignal<string>(\"\");\n  const [isLoading, setIsLoading] = createSignal(false);\n\n  const actions: Action[] = [\"read\", \"write\", \"delete\"];\n  const policyModes: PolicyMode[] = [\"combined\", \"rbac\", \"abac\", \"rebac\", \"strict\"];\n\n  const checkAccess = async () => {\n    setIsLoading(true);\n    setResult(null);\n    setTrace(\"\");\n\n    try {\n      const checker = createPermissionChecker(policyMode());\n      const evaluation = await checker.evaluateAccess({\n        subject: selectedUser(),\n        resource: selectedDoc(),\n        action: selectedAction(),\n        context: { timestamp: new Date() },\n      });\n\n      setResult(evaluation.isGranted() ? \"granted\" : \"denied\");\n      setTrace(evaluation.getDisplayTrace());\n    } catch (error) {\n      setTrace(`Error: ${error instanceof Error ? error.message : \"Unknown error\"}`);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div class=\"space-y-6\">\n      {/* Header */}\n      <div>\n        <h2 class=\"font-bold text-2xl\">Gatehouse Authorization Demo</h2>\n        <p class=\"text-muted-foreground\">\n          Test different authorization patterns: RBAC, ABAC, ReBAC, and combined policies\n        </p>\n      </div>\n\n      <div class=\"grid gap-6 lg:grid-cols-2\">\n        {/* Configuration Panel */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Configuration</CardTitle>\n            <CardDescription>\n              Select a user, document, action, and policy mode to test authorization\n            </CardDescription>\n          </CardHeader>\n          <CardContent class=\"space-y-6\">\n            {/* User Selection */}\n            <div class=\"space-y-2\">\n              <label class=\"font-medium text-sm\">User (Subject)</label>\n              <div class=\"grid grid-cols-2 gap-2\">\n                <For each={sampleUsers}>\n                  {(user) => (\n                    <button\n                      type=\"button\"\n                      class={`rounded-md border p-3 text-left text-sm transition-colors ${\n                        selectedUser().id === user.id\n                          ? \"border-primary bg-primary/10\"\n                          : \"hover:bg-muted\"\n                      }`}\n                      onClick={() => setSelectedUser(user)}\n                    >\n                      <div class=\"font-medium\">{user.name}</div>\n                      <div class=\"text-muted-foreground text-xs\">\n                        Roles: {user.roles.join(\", \")}\n                      </div>\n                      <div class=\"text-muted-foreground text-xs\">\n                        Dept: {user.department}\n                      </div>\n                    </button>\n                  )}\n                </For>\n              </div>\n            </div>\n\n            {/* Document Selection */}\n            <div class=\"space-y-2\">\n              <label class=\"font-medium text-sm\">Document (Resource)</label>\n              <div class=\"grid grid-cols-2 gap-2\">\n                <For each={sampleDocuments}>\n                  {(doc) => (\n                    <button\n                      type=\"button\"\n                      class={`rounded-md border p-3 text-left text-sm transition-colors ${\n                        selectedDoc().id === doc.id\n                          ? \"border-primary bg-primary/10\"\n                          : \"hover:bg-muted\"\n                      }`}\n                      onClick={() => setSelectedDoc(doc)}\n                    >\n                      <div class=\"font-medium\">{doc.title}</div>\n                      <div class=\"text-muted-foreground text-xs\">\n                        Owner: User #{doc.ownerId} | {doc.isPublic ? \"Public\" : \"Private\"}\n                      </div>\n                      <Show when={doc.requiredDepartment}>\n                        <div class=\"text-muted-foreground text-xs\">\n                          Dept: {doc.requiredDepartment}\n                        </div>\n                      </Show>\n                    </button>\n                  )}\n                </For>\n              </div>\n            </div>\n\n            {/* Action Selection */}\n            <div class=\"space-y-2\">\n              <label class=\"font-medium text-sm\">Action</label>\n              <div class=\"flex gap-2\">\n                <For each={actions}>\n                  {(action) => (\n                    <Button\n                      variant={selectedAction() === action ? \"default\" : \"outline\"}\n                      size=\"sm\"\n                      onClick={() => setSelectedAction(action)}\n                    >\n                      {action}\n                    </Button>\n                  )}\n                </For>\n              </div>\n            </div>\n\n            {/* Policy Mode Selection */}\n            <div class=\"space-y-2\">\n              <label class=\"font-medium text-sm\">Policy Mode</label>\n              <div class=\"flex flex-wrap gap-2\">\n                <For each={policyModes}>\n                  {(mode) => (\n                    <Button\n                      variant={policyMode() === mode ? \"default\" : \"outline\"}\n                      size=\"sm\"\n                      onClick={() => setPolicyMode(mode)}\n                    >\n                      {mode.toUpperCase()}\n                    </Button>\n                  )}\n                </For>\n              </div>\n              <p class=\"text-muted-foreground text-xs\">\n                {getPolicyDescription(policyMode())}\n              </p>\n            </div>\n\n            {/* Check Access Button */}\n            <Button \n              class=\"w-full\" \n              onClick={checkAccess}\n              disabled={isLoading()}\n            >\n              {isLoading() ? \"Checking...\" : \"Check Access\"}\n            </Button>\n          </CardContent>\n        </Card>\n\n        {/* Results Panel */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Result</CardTitle>\n            <CardDescription>\n              Authorization decision and evaluation trace\n            </CardDescription>\n          </CardHeader>\n          <CardContent class=\"space-y-4\">\n            {/* Result Badge */}\n            <Show when={result()}>\n              <div\n                class={`rounded-lg p-4 text-center font-bold text-lg ${\n                  result() === \"granted\"\n                    ? \"bg-green-500/20 text-green-600\"\n                    : \"bg-red-500/20 text-red-600\"\n                }`}\n              >\n                {result() === \"granted\" ? \"ACCESS GRANTED\" : \"ACCESS DENIED\"}\n              </div>\n            </Show>\n\n            {/* Request Summary */}\n            <Show when={result()}>\n              <div class=\"rounded-md bg-muted p-3 text-sm\">\n                <div class=\"font-medium\">Request Summary:</div>\n                <div class=\"mt-1 text-muted-foreground\">\n                  <span class=\"font-medium\">{selectedUser().name}</span> attempted to{\" \"}\n                  <span class=\"font-medium\">{selectedAction()}</span>{\" \"}\n                  <span class=\"font-medium\">\"{selectedDoc().title}\"</span>\n                </div>\n              </div>\n            </Show>\n\n            {/* Evaluation Trace */}\n            <Show when={trace()}>\n              <div class=\"space-y-2\">\n                <div class=\"font-medium text-sm\">Evaluation Trace:</div>\n                <pre class=\"max-h-[300px] overflow-auto whitespace-pre-wrap rounded-md bg-muted p-3 font-mono text-xs\">\n                  {trace()}\n                </pre>\n              </div>\n            </Show>\n\n            {/* Placeholder */}\n            <Show when={!result() && !trace()}>\n              <div class=\"flex min-h-[200px] items-center justify-center text-muted-foreground\">\n                Click \"Check Access\" to see the authorization result\n              </div>\n            </Show>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Policy Reference */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Policy Reference</CardTitle>\n          <CardDescription>\n            Understanding the different authorization patterns\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div class=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n            <div class=\"space-y-1\">\n              <h4 class=\"font-semibold\">RBAC (Role-Based)</h4>\n              <p class=\"text-muted-foreground text-sm\">\n                Access based on user roles. Viewers can read, editors can write, admins can delete.\n              </p>\n            </div>\n            <div class=\"space-y-1\">\n              <h4 class=\"font-semibold\">ABAC (Attribute-Based)</h4>\n              <p class=\"text-muted-foreground text-sm\">\n                Access based on attributes like public/private status or department matching.\n              </p>\n            </div>\n            <div class=\"space-y-1\">\n              <h4 class=\"font-semibold\">ReBAC (Relationship-Based)</h4>\n              <p class=\"text-muted-foreground text-sm\">\n                Access based on relationships like document ownership.\n              </p>\n            </div>\n            <div class=\"space-y-1\">\n              <h4 class=\"font-semibold\">Combined (OR)</h4>\n              <p class=\"text-muted-foreground text-sm\">\n                Grants access if ANY policy allows (owner OR public OR has role).\n              </p>\n            </div>\n            <div class=\"space-y-1\">\n              <h4 class=\"font-semibold\">Strict (AND)</h4>\n              <p class=\"text-muted-foreground text-sm\">\n                Requires ALL conditions: correct role AND matching department.\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nexport default GatehouseDemo;\n"
    },
    {
      "path": "lib/demo-policies.ts",
      "type": "registry:lib",
      "content": "/**\n * Demo Policies for Gatehouse Authorization Library\n * \n * This file demonstrates how to set up RBAC, ABAC, and ReBAC policies\n * using the Gatehouse-TS authorization library.\n */\n\nimport {\n  buildRbacPolicy,\n  buildAbacPolicy,\n  buildRebacPolicy,\n  buildOrPolicy,\n  buildAndPolicy,\n  PermissionChecker,\n} from \"@/lib/gatehouse\";\n\n// ============================================================================\n// Type Definitions\n// ============================================================================\n\nexport type User = {\n  id: number;\n  name: string;\n  roles: string[];\n  department: string;\n};\n\nexport type Document = {\n  id: number;\n  title: string;\n  ownerId: number;\n  isPublic: boolean;\n  requiredDepartment: string | null;\n};\n\nexport type Action = \"read\" | \"write\" | \"delete\";\n\nexport type Context = {\n  timestamp: Date;\n  ipAddress?: string;\n};\n\n// ============================================================================\n// Sample Data\n// ============================================================================\n\nexport const sampleUsers: User[] = [\n  { id: 1, name: \"Alice (Admin)\", roles: [\"admin\"], department: \"Engineering\" },\n  { id: 2, name: \"Bob (Editor)\", roles: [\"editor\"], department: \"Marketing\" },\n  { id: 3, name: \"Charlie (Viewer)\", roles: [\"viewer\"], department: \"Sales\" },\n  { id: 4, name: \"Diana (Engineer)\", roles: [\"viewer\"], department: \"Engineering\" },\n];\n\nexport const sampleDocuments: Document[] = [\n  { \n    id: 101, \n    title: \"Public Announcement\", \n    ownerId: 1, \n    isPublic: true, \n    requiredDepartment: null \n  },\n  { \n    id: 102, \n    title: \"Engineering Specs\", \n    ownerId: 1, \n    isPublic: false, \n    requiredDepartment: \"Engineering\" \n  },\n  { \n    id: 103, \n    title: \"Bob's Draft\", \n    ownerId: 2, \n    isPublic: false, \n    requiredDepartment: null \n  },\n  { \n    id: 104, \n    title: \"Marketing Strategy\", \n    ownerId: 2, \n    isPublic: false, \n    requiredDepartment: \"Marketing\" \n  },\n];\n\n// ============================================================================\n// Individual Policies\n// ============================================================================\n\n/**\n * RBAC Policy - Role-Based Access Control\n * \n * Grants access based on user roles:\n * - read: viewer, editor, admin\n * - write: editor, admin\n * - delete: admin only\n */\nexport const rbacPolicy = buildRbacPolicy<User, Document, Action, Context, string>({\n  name: \"RBAC Policy\",\n  requiredRolesResolver: (_resource, action) => {\n    switch (action) {\n      case \"read\":\n        return [\"viewer\", \"editor\", \"admin\"];\n      case \"write\":\n        return [\"editor\", \"admin\"];\n      case \"delete\":\n        return [\"admin\"];\n      default:\n        return [];\n    }\n  },\n  userRolesResolver: (user) => user.roles,\n});\n\n/**\n * ABAC Policy - Attribute-Based Access Control (Public Documents)\n * \n * Grants read access to any public document, regardless of user roles.\n */\nexport const publicDocPolicy = buildAbacPolicy<User, Document, Action, Context>({\n  name: \"Public Document Policy\",\n  condition: ({ resource, action }) => resource.isPublic && action === \"read\",\n});\n\n/**\n * ABAC Policy - Department-Based Access\n * \n * Grants access when the user's department matches the document's required department.\n */\nexport const departmentPolicy = buildAbacPolicy<User, Document, Action, Context>({\n  name: \"Department Policy\",\n  condition: ({ subject, resource }) => \n    resource.requiredDepartment !== null && \n    subject.department === resource.requiredDepartment,\n});\n\n/**\n * ReBAC Policy - Relationship-Based Access Control (Ownership)\n * \n * Grants full access when the user owns the document.\n */\nexport const ownerPolicy = buildRebacPolicy<User, Document, Action, Context>({\n  name: \"Owner Policy\",\n  relationship: \"owner\",\n  resolver: ({ subject, resource }) => subject.id === resource.ownerId,\n});\n\n// ============================================================================\n// Combined Policies\n// ============================================================================\n\n/**\n * Combined OR Policy\n * \n * Grants access if ANY of these conditions are met:\n * 1. User is the document owner (ReBAC)\n * 2. Document is public and action is read (ABAC)\n * 3. User has the required role (RBAC)\n */\nexport const combinedOrPolicy = buildOrPolicy<User, Document, Action, Context>({\n  name: \"Combined Access Policy (OR)\",\n  policies: [ownerPolicy, publicDocPolicy, rbacPolicy],\n});\n\n/**\n * Strict AND Policy\n * \n * Requires BOTH conditions:\n * 1. User must have correct role (RBAC)\n * 2. User must be in the correct department (ABAC)\n */\nexport const strictAndPolicy = buildAndPolicy<User, Document, Action, Context>({\n  name: \"Strict Access Policy (AND)\",\n  policies: [rbacPolicy, departmentPolicy],\n});\n\n// ============================================================================\n// Permission Checker Factory\n// ============================================================================\n\nexport type PolicyMode = \"combined\" | \"rbac\" | \"abac\" | \"rebac\" | \"strict\";\n\n/**\n * Creates a PermissionChecker configured with the specified policy mode.\n * \n * @param mode - The policy configuration to use\n * @returns A configured PermissionChecker instance\n */\nexport function createPermissionChecker(mode: PolicyMode = \"combined\") {\n  const checker = new PermissionChecker<User, Document, Action, Context>();\n\n  switch (mode) {\n    case \"rbac\":\n      checker.addPolicy(rbacPolicy);\n      break;\n    case \"abac\":\n      checker.addPolicy(publicDocPolicy);\n      checker.addPolicy(departmentPolicy);\n      break;\n    case \"rebac\":\n      checker.addPolicy(ownerPolicy);\n      break;\n    case \"strict\":\n      checker.addPolicy(strictAndPolicy);\n      break;\n    case \"combined\":\n    default:\n      checker.addPolicy(combinedOrPolicy);\n      break;\n  }\n\n  return checker;\n}\n\n/**\n * Get human-readable description of a policy mode\n */\nexport function getPolicyDescription(mode: PolicyMode): string {\n  switch (mode) {\n    case \"rbac\":\n      return \"Role-based only: Access based on user roles (viewer/editor/admin)\";\n    case \"abac\":\n      return \"Attribute-based only: Access based on document and user attributes\";\n    case \"rebac\":\n      return \"Relationship-based only: Access only for document owners\";\n    case \"strict\":\n      return \"Strict AND: Requires both correct role AND matching department\";\n    case \"combined\":\n    default:\n      return \"Combined OR: Grants access if owner OR public OR has role\";\n  }\n}\n"
    }
  ]
}
